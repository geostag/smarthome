[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"realistic-torvalds-d86001"},"spec":{"every":"5m","name":"daily green used","offset":"3m0s","query":"import \"date\"\n\n\n\na =\n    from(bucket: \"smarthomederived\")\n        |> range(start: today())\n        |> filter(fn: (r) => r._measurement == \"daily_energy\" and r._field == \"green_injected\")\n        |> last()\n        |> map(fn: (r) => ({r with join_key: \"x\"}))\n\nb =\n    from(bucket: \"smarthomederived\")\n        |> range(start: date.add(to: today(), d: -1h))\n        |> filter(fn: (r) => r._measurement == \"daily_energy\" and r._field == \"green_upstream\")\n        |> last()\n        |> map(fn: (r) => ({r with join_key: \"x\"}))\n\njoin(tables: {a: a, b: b}, on: [\"join_key\"])\n    |> map(\n        fn: (r) =>\n            ({\n                _time: date.add(to: today(), d: 3h),\n                _measurement: \"daily_energy\",\n                _field: \"green_used\",\n                _value: r._value_a + r._value_b,\n            }),\n    )\n    |> to(bucket: \"smarthomederived\")"}}]