[{"apiVersion":"influxdata.com/v2alpha1","kind":"Task","metadata":{"name":"friendly-mclean-186001"},"spec":{"every":"5m","name":"daily swm used","offset":"1m0s","query":"import \"date\"\n\n\n\nstart_of_day =\n    from(bucket: \"smarthome\")\n        |> range(start: -36h, stop: today())\n        |> filter(fn: (r) => r._measurement == \"tasmota\" and r._field == \"Total\")\n        |> last()\n        |> map(fn: (r) => ({r with join_key: \"x\"}))\n\ncurrent =\n    from(bucket: \"smarthome\")\n        |> range(start: -10m)\n        |> filter(fn: (r) => r._measurement == \"tasmota\" and r._field == \"Total\")\n        |> last()\n        |> map(fn: (r) => ({r with join_key: \"x\"}))\n\njoin(tables: {s: start_of_day, c: current}, on: [\"join_key\"])\n    |> map(\n        fn: (r) =>\n            ({\n                _time: date.add(to: today(), d: 3h),\n                _measurement: \"daily_energy\",\n                _field: \"swm_used\",\n                _value: (r._value_c - r._value_s) * 1000.0,\n            }),\n    )\n    |> to(bucket: \"smarthomederived\")"}}]